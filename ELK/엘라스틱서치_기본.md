# 엘라스틱서치 기본
> 빅데이터와 분산 시스템이라는 패러다임 변화에 따라 엘라스틱서치가 아파치 재단의 솔라, 루씬의 자리를 대체하며 최근에 많은 사랑을 받고 있다.
> 단순한 검색엔진을 넘어 데이터 수집부터 저장, 분석, 시각화에 이르는 다양한 분야의 데이터 분석 도구로서 주목받고 있다.

## 기본 용어

#### 인덱스(Index)
 - 데이터 저장 공간
 - 하나의 인덱스(Index)는 하나의 타입(Type)을 가짐
 - 하나의 물리적인 노드는 여러개의 논리적인 인덱스(Index)를 생성할 수 있음
 - 분산 환경으로 구성하면 하나의 인덱스(Index)가 여러 노드에 분산 저장되어 관리됨
 - 기본적으로 인덱스(Index) 생성 시 5개의 Primary Shard와 1개의 Replica Shard 세트를 생성

#### 샤드(Shard)
 - 인덱스 내부에 색인된 데이터는 물리적인 공간에 여러 개의 파티션으로 구성되고 이 파티션을 샤드(Shard)라고 부른다
 - 엘라스틱서치는 다수의 샤드로 문서를 분산 저장하고 있어 데이터 손실 위험을 최소화함

#### 타입(Type)
 - 인덱스의 논리적 구조
 - 엘라스틱서치 6.0버전 이하에서는 하나의 인덱스에 여러 타입을 설정할 수 있었지만 6.1버전부터는 인덱스당 하나의 타입만 사용할 수 있음
 
#### 문서(Document)
 - 문서는 엘라스틱서치에서 데이터가 저장되는 최소 단위
 - JSON 포맷으로 데이터가 저장됨
 - 데이터베이스의 테이블 행(Row)와 유사

#### 필드(Field)
 - 문서(Document)를 구성하기 위한 속성
 - 데이터베이스의 테이블의 열, 칼럼(Column)과 비교되곤 하지만, 칼럼이 정적인 데이터 타입인 데 반해 필드는 좀 더 동적인 데이터 타입
 - 하나의 필드는 목적에 따라 다수의 데이터 타입을 가질 수 있음
 
#### 매핑(Mapping)
 - 매핑은 문서의 필드와 필드의 속성을 정의하고 그에 따른 색인 방법을 정의하는 프로세스
 - 인덱스의 매핑 정보에는 여러가지 데이터 타입을 지정할 수 있지만 필드명은 중복해서 사용할 수 없다


## 노드의 종류
>  클러스터는 물리적인 노드의 모임이라고 할 수 있다. 분산 처리를 위해서는 다양한 형태의 노드들을 조합해서 클러스터를 구성해야 한다.

#### 마스터 노드(Master Node)
 - 클러스터를 관리
 - 노드 추가와 제거 같은 클러스터의 전반적인 관리를 담당
 - 네트워크 속도가 빠르고 지연이 없는 노드를 마스터 노드로 선정해야 한다
 - 다수의 노드를 마스터 노드로 설정할 수 있지만 결과적으로 하나의 노드만이 마스터 노드로 선출되어 동작함
 - 마스터 노드로 설정
    ```
    node.master : true
    node.data : false
    node.ingest : false
    search.remote.connect : false
    ```
 
#### 데이터 노드(Data Node)
 - 실질적인 데이터를 저장
 - 검색과 통계 같은 데이터 관련 작업을 수행
 - 데이터 노드는 가능한 마스터 노드와 분리해서 구성하는 게 좋다
 - 데이터 노드로 설정
     ```
     node.master : false
     node.data : true
     node.ingest : false
     search.remote.connect : false
     ```
 
#### 코디네이팅 노드(Coordinating Node)
 - 사용자의 요청만 받아서 처리
 - 클러스터 관련 요청은 마스터 노드에 전달하고 데이터 관련 요청은 데이터 노드에 전달
 - 데이터 노드, 마스터 노드, 인제스트 노드의 역할을 하지 않고 오직 들어온 요청을 라운드로빈 방식으로 분산시켜 주는 노드
 - 데이터 노드로 설정
      ```
      node.master : false
      node.data : false
      node.ingest : false
      search.remote.connect : false
      ```
 
#### 인제스트 노드(Ingest Node)
 - 색인에 앞서 문서의 전처리 작업을 담당
 - 인덱스 생성 전 문서의 형식을 다양하게 변경
  - 데이터 노드로 설정
       ```
       node.master : false
       node.data : false
       node.ingest : true
       search.remote.connect : false
       ```
    
## 클러스터와 노드 그리고 샤드
> 클러스터는 물리적인 노드들의 집합체이며 각각의 물리적인 노드는 샤드의 개수로 분산되어 색인, 저장된다

 - 샤드는 프라이머리 샤드와 레플리카 샤드로 구분되며, 엘라스틱서치 장애 시 레플리카 샤드를 이용해 샤드를 복구한다.
 - 프라이머리 샤드와 레플리카 샤드는 서로 다른 노드에 배치된다
 - 장애가 발생하면 마스터 노드는 데이터를 재분배하거나 레플리카 샤드를 프라이머리 샤드로 승격시켜 서비스 중단 없는 복구가 가능
